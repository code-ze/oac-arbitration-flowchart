<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>OAC Arbitration Process Flowchart</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
        }

        #main {
            width: 100%;
            height: 800px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            padding: 15px 0;
            background-color: #f0f6ff;
            border-radius: 8px 8px 0 0;
            border-bottom: 1px solid #e0e6f0;
        }

        .header h1 {
            margin: 0;
            font-size: 24px;
            color: #2c3e50;
        }

        .legend {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 250px;
            opacity: 0.9;
        }

        .legend h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 4px;
        }

        .legend-text {
            font-size: 14px;
            color: #5a6a85;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-wrap: wrap;
            max-width: 600px;
        }

        .btn {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            background-color: #4285f4;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
        }

        .btn:hover {
            background-color: #3367d6;
        }

        .btn.active {
            background-color: #1a237e;
        }

        .btn.secondary {
            background-color: #9e9e9e;
        }

        .btn.secondary:hover {
            background-color: #757575;
        }

        .timeline-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 300px;
            font-size: 14px;
            color: #5a6a85;
        }

        .search-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
        }

        .search-input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 200px;
        }

        .search-btn {
            margin-left: 5px;
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            background-color: #4285f4;
            color: white;
            cursor: pointer;
        }

        .tooltip-custom {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            max-width: 350px;
            font-size: 14px;
            color: #333;
            display: none;
        }

        .tooltip-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .tooltip-content {
            line-height: 1.4;
        }

        .tooltip-article {
            font-style: italic;
            color: #4285f4;
        }

        .tooltip-close {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #666;
            transition: background-color 0.2s;
        }

        .tooltip-close:hover {
            background-color: #ddd;
            color: #333;
        }

        .node-searchresult {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(66, 133, 244, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(66, 133, 244, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(66, 133, 244, 0);
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
</head>

<body>
    <div class="header">
        <h1>OAC Arbitration Process Flowchart </h1>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" class="search-input" placeholder="Search articles or terms...">
        <button id="search-btn" class="search-btn">Search</button>
    </div>

    <div class="legend">
        <h3>Participants</h3>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #4caf50;"></div>
            <div class="legend-text">Claimant</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ff9800;"></div>
            <div class="legend-text">Respondent</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #f44336;"></div>
            <div class="legend-text">OAC Admin/Registrar</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #2196f3;"></div>
            <div class="legend-text">Arbitral Tribunal</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #009688;"></div>
            <div class="legend-text">Emergency Arbitrator</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #9c27b0;"></div>
            <div class="legend-text">All Parties</div>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #673ab7;"></div>
            <div class="legend-text">Fees & Costs</div>
        </div>
        <h3>Line Types</h3>
        <div class="legend-item">
            <svg width="50" height="20">
                <line x1="0" y1="10" x2="50" y2="10" stroke="#555" stroke-width="2"></line>
                <polygon points="46,6 50,10 46,14" fill="#555"></polygon>
            </svg>
            <div class="legend-text">Mandatory Step</div>
        </div>
        <div class="legend-item">
            <svg width="50" height="20">
                <line x1="0" y1="10" x2="50" y2="10" stroke="#555" stroke-width="2" stroke-dasharray="5,3"></line>
                <polygon points="46,6 50,10 46,14" fill="#555"></polygon>
            </svg>
            <div class="legend-text">Optional Step</div>
        </div>
    </div>

    <div class="controls">
        <button id="view-main" class="btn active">Main Process</button>
        <button id="view-emergency" class="btn">Emergency Arbitrator</button>
        <button id="view-tribunal" class="btn">Tribunal Constitution</button>
        <button id="view-post-award" class="btn">Post-Award Actions</button>
        <button id="view-fees" class="btn">Fees & Costs</button>
        <button id="zoom-reset" class="btn secondary">Reset View</button>
    </div>

    <div class="timeline-info">
        <div id="timeline-text">Average timeline: 9-12 months from Request to Award</div>
    </div>

    <div id="main"></div>

    <div class="tooltip-custom" id="tooltip-custom">
        <div class="tooltip-title" id="tooltip-title"></div>
        <div class="tooltip-content" id="tooltip-content"></div>
        <div class="tooltip-article" id="tooltip-article"></div>
        <div class="tooltip-close" id="tooltip-close">âœ—</div>
    </div>

    <script>
        // Initialize chart
        var chart = echarts.init(document.getElementById('main'));

        // Enable chart to resize with window
        window.addEventListener('resize', function () {
            chart.resize();
        });

        // Custom tooltip
        var tooltip = document.getElementById('tooltip-custom');
        var tooltipTitle = document.getElementById('tooltip-title');
        var tooltipContent = document.getElementById('tooltip-content');
        var tooltipArticle = document.getElementById('tooltip-article');

        // Timeline text updating
        var timelineTexts = {
            'main': 'Average timeline: 9-12 months from Request to Award',
            'emergency': 'Emergency measures: Decision within 14 days of appointment (Art 19.11)',
            'tribunal': 'Tribunal constitution: Typically 4-6 weeks after Response',
            'post-award': 'Post-award actions: Must be initiated within 28 days of award receipt',
            'fees': 'Administrative fees and arbitrator fees based on claim value (Art 42-47)'
        };

        // Main process data with improved positioning
        var mainProcessData = {
            nodes: [
                // Phase 1: Commencement
                {
                    id: 'start', name: 'Start Arbitration', symbolSize: 50, symbol: 'circle', category: 0, x: 0, y: 0,
                    value: 'Starting point of the arbitration process. The Claimant initiates the proceedings by submitting a Request for Arbitration to the OAC.'
                },

                {
                    id: 'request', name: 'Submit Request for Arbitration', symbolSize: 40, category: 0, x: 300, y: 0,
                    value: 'The Claimant must submit a formal Request including: demand for arbitration, party details, arbitration agreement, contract copy, dispute description, relief sought, procedural proposals, arbitrator nomination (if applicable), applicable law, language/seat proposals, and registration fee payment.',
                    article: 'Articles 4.1-4.3'
                },

                {
                    id: 'notify', name: 'Notify Respondent', symbolSize: 40, category: 2, x: 600, y: 0,
                    value: 'The OAC Registrar notifies the Respondent of receipt of the Request for Arbitration and transmits a copy to them.',
                    article: 'Article 4.1'
                },

                {
                    id: 'check_jurisdiction', name: 'Check Jurisdiction', symbolSize: 40, category: 2, x: 600, y: 150,
                    value: 'The Executive Committee reviews the Request to confirm that OAC has jurisdiction. If OAC manifestly lacks jurisdiction, the Committee may decide not to proceed.',
                    article: 'Article 4.4'
                },

                {
                    id: 'response', name: 'Prepare Response', symbolSize: 40, category: 1, x: 900, y: 0,
                    value: 'Within 21 days (extendable by 14 days), the Respondent submits a Response including: Respondent details, confirmation/denial of claims, jurisdictional objections if any, comments on Claimant\'s proposals, and arbitrator nomination if applicable.',
                    article: 'Article 5.1, 5.4'
                },

                {
                    id: 'counterclaim', name: 'Optional: Counterclaim', symbolSize: 30, category: 1, x: 900, y: 150,
                    value: 'The Respondent may submit a counterclaim with details of: nature, circumstances, relief sought, amount, relevant agreements, and a registration fee payment.',
                    article: 'Article 5.6, 43.1'
                },

                {
                    id: 'receive_response', name: 'Process Response', symbolSize: 40, category: 2, x: 1200, y: 0,
                    value: 'The OAC Registrar processes the Response and any Counterclaim, verifies fee payment for counterclaims, and communicates these documents to the Claimant.',
                    article: 'Article 5.5'
                },

                {
                    id: 'reply', name: 'Reply to Counterclaim', symbolSize: 40, category: 0, x: 1500, y: 75,
                    value: 'If a counterclaim was filed, the Claimant has 21 days (extendable by 14 days) to submit a Reply including facts, legal grounds, and relief sought in response to the counterclaim.',
                    article: 'Article 5.7'
                },

                // Phase 2: Tribunal Constitution
                {
                    id: 'determine_arbitrators', name: 'Determine Number of Arbitrators', symbolSize: 40, category: 2, x: 1800, y: 0,
                    value: 'If not specified in the arbitration agreement and the parties haven\'t agreed within 21 days, the Executive Committee determines the number of arbitrators.',
                    article: 'Article 10.2'
                },

                {
                    id: 'nominate_arbitrators', name: 'Nomination Process', symbolSize: 40, category: 2, x: 2100, y: 0,
                    value: 'For sole arbitrator: parties nominate jointly or OAC appoints. For three arbitrators: each party nominates one, co-arbitrators nominate president or OAC appoints.',
                    article: 'Article 11'
                },

                {
                    id: 'appoint_arbitrators', name: 'Send Appointment Notice', symbolSize: 40, category: 2, x: 2400, y: 0,
                    value: 'The OAC Registrar sends notice of appointment to the arbitrator nominees.',
                    article: 'Article 12.1'
                },

                {
                    id: 'accept_appointment', name: 'Accept Appointment', symbolSize: 40, category: 3, x: 2700, y: 0,
                    value: 'Arbitrators must accept within 7 days by submitting a written declaration confirming impartiality and independence, disclosing any circumstances that might cause doubt.',
                    article: 'Article 12.3'
                },

                {
                    id: 'tribunal_constitution', name: 'Tribunal Constitution Complete', symbolSize: 40, category: 3, x: 3000, y: 0,
                    value: 'The Arbitral Tribunal is officially constituted once all arbitrators are appointed, have accepted, and any challenges are resolved. This occurs by an act dated and signed by the arbitrators.',
                    article: 'Article 20.3'
                },

                // Phase 3: Fees & File Transmission
                {
                    id: 'calculate_fees', name: 'Calculate & Request Fees', symbolSize: 40, category: 2, x: 3000, y: 150,
                    value: 'The Registrar calculates administrative fees based on claim/counterclaim values and determines the deposit amount required to cover tribunal fees and expenses.',
                    article: 'Article 44.1, 45.1, 45.2'
                },

                {
                    id: 'pay_fees', name: 'Pay Fees', symbolSize: 40, category: 5, x: 3300, y: 150,
                    value: 'Parties must pay fees within 14 days. Failure may lead to suspension/termination of proceedings or deemed withdrawal of claims.',
                    article: 'Article 44.5, 45.3, 45.4'
                },

                {
                    id: 'transmit_file', name: 'Transmit File to Tribunal', symbolSize: 40, category: 2, x: 3300, y: 0,
                    value: 'Once fees are paid in full, the Registrar transmits the complete case file (Request, Response, annexes, etc.) to the constituted Arbitral Tribunal.',
                    article: 'Article 21'
                },

                // Phase 4: Proceedings
                {
                    id: 'preliminary_meeting', name: 'Preliminary Meeting & TOR', symbolSize: 40, category: 3, x: 3600, y: 0,
                    value: 'Within 14 days of receiving the file, the Tribunal contacts the parties to schedule a preliminary meeting. The Tribunal drafts and finalizes Terms of Reference (TOR) and establishes a procedural timetable.',
                    article: 'Article 28.1, 28.2'
                },

                {
                    id: 'statement_claim', name: 'Statement of Claim', symbolSize: 40, category: 0, x: 3900, y: -150,
                    value: 'The Claimant submits a detailed Statement of Claim including facts, legal grounds, relief sought, and supporting documents according to the procedural timetable.',
                    article: 'Article 29.1'
                },

                {
                    id: 'statement_defence', name: 'Statement of Defence', symbolSize: 40, category: 1, x: 3900, y: 0,
                    value: 'The Respondent submits a detailed Statement of Defence including facts, legal grounds, relief sought, and supporting documents according to the procedural timetable.',
                    article: 'Article 29.2'
                },

                {
                    id: 'reply_detailed', name: 'Reply to Counterclaim', symbolSize: 40, category: 0, x: 3900, y: 150,
                    value: 'If applicable, the Claimant submits a Reply to any counterclaim according to the procedural timetable.',
                    article: 'Article 29.3'
                },

                {
                    id: 'conduct_proceedings', name: 'Conduct of Proceedings', symbolSize: 50, category: 3, x: 4200, y: 0,
                    value: 'The Tribunal manages the proceedings, including submissions, evidence exchange, procedural matters, jurisdictional pleas, confidentiality, interim measures, document production, and other aspects of the case.',
                    article: 'Articles 25-35'
                },

                {
                    id: 'hearings', name: 'Hold Hearings', symbolSize: 40, category: 3, x: 4500, y: -75,
                    value: 'If requested or deemed necessary, the Tribunal holds hearings with at least 7 days prior notice to the parties. The Tribunal manages witness and expert evidence.',
                    article: 'Article 30.2, 31, 32'
                },

                {
                    id: 'close_proceedings', name: 'Close Proceedings', symbolSize: 40, category: 3, x: 4800, y: 0,
                    value: 'When the Tribunal determines parties have had adequate opportunity to present their case, it declares the proceedings closed and notifies the parties and OAC Registrar.',
                    article: 'Article 36.1, 39.1'
                },

                // Phase 5: Award
                {
                    id: 'deliberate', name: 'Deliberate & Draft Award', symbolSize: 40, category: 3, x: 5100, y: 0,
                    value: 'The Tribunal reviews all submissions and evidence, decides on the merits, and drafts a reasoned Award within 6 months from the date of the Terms of Reference, including decisions on costs allocation.',
                    article: 'Article 39.2, 40.1, 40.5, 42.1, 46'
                },

                {
                    id: 'sign_award', name: 'Sign Award', symbolSize: 40, category: 3, x: 5400, y: 0,
                    value: 'The Award must be signed by the arbitrators. The president of the Tribunal must sign all pages. In a panel, decisions are made by majority.',
                    article: 'Article 40.2, 40.5'
                },

                {
                    id: 'transmit_award', name: 'Transmit Award to OAC', symbolSize: 40, category: 3, x: 5700, y: 0,
                    value: 'The Tribunal transmits the signed Award to the Registrar. The Award is deemed made at the seat of arbitration on the date stated in it.',
                    article: 'Article 40.6'
                },

                {
                    id: 'communicate_award', name: 'Communicate Award', symbolSize: 40, category: 2, x: 6000, y: 0,
                    value: 'The Registrar communicates the original Award to the parties and processes the return of any unexpended cost deposits.',
                    article: 'Article 40.6, 45.5'
                },

                {
                    id: 'receive_award', name: 'Receive Award', symbolSize: 40, category: 5, x: 6000, y: 150,
                    value: 'The parties receive the Award, which is binding and must be carried out without delay. Parties may only challenge it through an action for nullity.',
                    article: 'Article 40.8'
                },

                // Phase 6: Post-Award (separate view)
                {
                    id: 'post_award', name: 'Post-Award Actions', symbolSize: 40, category: 5, x: 6300, y: 0,
                    value: 'Optional: Parties may request Interpretation, Correction, or Additional Award within 28 days of receipt.',
                    article: 'Article 41.1, 41.2, 41.4'
                },

                {
                    id: 'end', name: 'End', symbolSize: 50, symbol: 'circle', category: 5, x: 6600, y: 0,
                    value: 'Conclusion of the arbitration process.'
                }
            ],
            links: [
                // Phase connections
                { source: 'start', target: 'request', label: { show: false, formatter: 'Initiates' } },
                { source: 'request', target: 'notify' },
                { source: 'notify', target: 'check_jurisdiction' },
                { source: 'check_jurisdiction', target: 'response', label: { show: true, formatter: 'If jurisdiction exists' } },
                { source: 'response', target: 'counterclaim', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'response', target: 'receive_response' },
                { source: 'counterclaim', target: 'receive_response' },
                { source: 'receive_response', target: 'reply', label: { show: true, formatter: 'If counterclaim filed' } },
                { source: 'receive_response', target: 'determine_arbitrators', label: { show: true, formatter: 'No counterclaim' } },
                { source: 'reply', target: 'determine_arbitrators' },
                { source: 'determine_arbitrators', target: 'nominate_arbitrators' },
                { source: 'nominate_arbitrators', target: 'appoint_arbitrators' },
                { source: 'appoint_arbitrators', target: 'accept_appointment' },
                { source: 'accept_appointment', target: 'tribunal_constitution' },
                { source: 'tribunal_constitution', target: 'calculate_fees' },
                { source: 'calculate_fees', target: 'pay_fees' },
                { source: 'pay_fees', target: 'transmit_file', label: { show: true, formatter: 'When paid in full' } },
                { source: 'transmit_file', target: 'preliminary_meeting' },
                { source: 'preliminary_meeting', target: 'statement_claim', label: { show: false, formatter: 'Per timetable' } },
                { source: 'preliminary_meeting', target: 'statement_defence', label: { show: false, formatter: 'Per timetable' } },
                { source: 'preliminary_meeting', target: 'reply_detailed', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If counterclaim exists' } },
                { source: 'statement_claim', target: 'conduct_proceedings' },
                { source: 'statement_defence', target: 'conduct_proceedings' },
                { source: 'reply_detailed', target: 'conduct_proceedings' },
                { source: 'conduct_proceedings', target: 'hearings', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If requested/needed' } },
                { source: 'hearings', target: 'close_proceedings' },
                { source: 'conduct_proceedings', target: 'close_proceedings', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Doc-only possible' } },
                { source: 'close_proceedings', target: 'deliberate' },
                { source: 'deliberate', target: 'sign_award' },
                { source: 'sign_award', target: 'transmit_award' },
                { source: 'transmit_award', target: 'communicate_award' },
                { source: 'communicate_award', target: 'receive_award' },
                { source: 'receive_award', target: 'post_award', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'post_award', target: 'end' },
                { source: 'receive_award', target: 'end', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If no post-award actions' } }
            ]
        };

        // Emergency Arbitrator process data with improved positioning
        var emergencyArbitratorData = {
            nodes: [
                {
                    id: 'ea_start', name: 'Start Emergency Process', symbolSize: 50, symbol: 'circle', category: 0, x: 0, y: 0,
                    value: 'A party may seek emergency interim relief before the constitution of the Arbitral Tribunal.'
                },

                {
                    id: 'ea_apply', name: 'Apply for Emergency Relief', symbolSize: 40, category: 0, x: 200, y: 0,
                    value: 'Party submits application specifying: the nature of relief sought, reasons for entitlement, and certification that other parties have been notified. Must pay non-refundable administrative fee and deposits.',
                    article: 'Article 19.1, 19.2'
                },

                {
                    id: 'ea_appoint', name: 'Appoint Emergency Arbitrator', symbolSize: 40, category: 2, x: 400, y: 0,
                    value: 'If application is accepted, the Executive Committee appoints an Emergency Arbitrator within 2 days of receipt. The seat is Muscat unless otherwise agreed.',
                    article: 'Article 19.3, 19.4'
                },

                {
                    id: 'ea_disclose', name: 'EA Accepts & Discloses', symbolSize: 40, category: 4, x: 600, y: -50,
                    value: 'Prospective Emergency Arbitrator discloses any circumstances that might affect impartiality or independence prior to appointment.',
                    article: 'Article 19.5'
                },

                {
                    id: 'ea_challenge', name: 'Optional: Challenge EA', symbolSize: 30, category: 5, x: 600, y: 100,
                    value: 'Parties may challenge the Emergency Arbitrator within 2 days. The Executive Committee decides after giving opportunity for comments.',
                    article: 'Article 19.5, 19.6'
                },

                {
                    id: 'ea_schedule', name: 'Establish Schedule', symbolSize: 40, category: 4, x: 800, y: -50,
                    value: 'Within 2 days of appointment, the Emergency Arbitrator establishes a schedule for considering the application, providing reasonable opportunity for parties to be heard.',
                    article: 'Article 19.9'
                },

                {
                    id: 'ea_conduct', name: 'Conduct Proceedings', symbolSize: 40, category: 4, x: 1000, y: 0,
                    value: 'The Emergency Arbitrator may conduct proceedings by telephone, video, written submissions, or in-person hearings, and has authority to rule on own jurisdiction.',
                    article: 'Article 19.9'
                },

                {
                    id: 'ea_order', name: 'Issue Interim Order/Award', symbolSize: 40, category: 4, x: 1200, y: 0,
                    value: 'The Emergency Arbitrator issues order or award within 14 days of appointment (extendable in exceptional circumstances), with summary reasons and possibly conditional on security.',
                    article: 'Article 19.10, 19.11, 19.13'
                },

                {
                    id: 'ea_transmit', name: 'Transmit to OAC', symbolSize: 40, category: 4, x: 1400, y: -50,
                    value: 'The Emergency Arbitrator transmits the order or award to the OAC.'
                },

                {
                    id: 'ea_communicate', name: 'Communicate to Parties', symbolSize: 40, category: 2, x: 1600, y: -50,
                    value: 'OAC communicates the Emergency Arbitrator\'s order or award to the parties.'
                },

                {
                    id: 'ea_implement', name: 'Implement Order/Award', symbolSize: 40, category: 5, x: 1800, y: 0,
                    value: 'The parties are bound by the order/award immediately, undertake to carry it out without delay, and waive rights to appeal to the extent legally permitted.',
                    article: 'Article 19.14'
                },

                {
                    id: 'ea_end', name: 'EA Proceedings Cease', symbolSize: 40, category: 4, x: 2000, y: 0,
                    value: 'Emergency Arbitrator proceedings cease when the Arbitral Tribunal is constituted. The Tribunal may reconsider, modify, terminate or annul the emergency decision.',
                    article: 'Article 19.16'
                }
            ],
            links: [
                // Phase connections
                { source: 'ea_start', target: 'ea_apply', label: { show: false, formatter: 'Initiates' } },
                { source: 'ea_apply', target: 'ea_appoint' },
                { source: 'ea_appoint', target: 'ea_disclose' },
                { source: 'ea_disclose', target: 'ea_challenge', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'ea_disclose', target: 'ea_schedule' },
                { source: 'ea_challenge', target: 'ea_schedule', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If challenge fails' } },
                { source: 'ea_schedule', target: 'ea_conduct' },
                { source: 'ea_conduct', target: 'ea_order' },
                { source: 'ea_order', target: 'ea_transmit' },
                { source: 'ea_transmit', target: 'ea_communicate' },
                { source: 'ea_communicate', target: 'ea_implement' },
                { source: 'ea_implement', target: 'ea_end' }
            ]
        };

        // Post-Award Actions data
        var postAwardData = {
            nodes: [
                {
                    id: 'pa_start', name: 'Award Received', symbolSize: 50, symbol: 'circle', category: 5, x: 0, y: 0,
                    value: 'The parties receive the Final Award from the OAC Registrar. This starts the 28-day time period for post-award actions.',
                    article: 'Article 41.1, 41.2, 41.4'
                },

                {
                    id: 'pa_correction', name: 'Request Correction', symbolSize: 40, category: 5, x: 300, y: -150,
                    value: 'Within 28 days of receipt, a party may request the Tribunal to correct computational, clerical, typographical or similar errors in the Award.',
                    article: 'Article 41.1'
                },

                {
                    id: 'pa_interpretation', name: 'Request Interpretation', symbolSize: 40, category: 5, x: 300, y: 0,
                    value: 'Within 28 days of receipt, a party may request the Tribunal to give an interpretation of a specific point or part of the Award.',
                    article: 'Article 41.2'
                },

                {
                    id: 'pa_additional', name: 'Request Additional Award', symbolSize: 40, category: 5, x: 300, y: 150,
                    value: 'Within 28 days of receipt, a party may request the Tribunal to make an additional award as to claims presented but omitted from the Award.',
                    article: 'Article 41.4'
                },

                {
                    id: 'pa_notify_correction', name: 'Notify Other Party', symbolSize: 40, category: 2, x: 550, y: -150,
                    value: 'The Registrar notifies the other party of the correction request and gives them opportunity to comment.',
                    article: 'Article 41.1'
                },

                {
                    id: 'pa_notify_interpretation', name: 'Notify Other Party', symbolSize: 40, category: 2, x: 550, y: 0,
                    value: 'The Registrar notifies the other party of the interpretation request and gives them opportunity to comment.',
                    article: 'Article 41.2'
                },

                {
                    id: 'pa_notify_additional', name: 'Notify Other Party', symbolSize: 40, category: 2, x: 550, y: 150,
                    value: 'The Registrar notifies the other party of the additional award request and gives them opportunity to comment.',
                    article: 'Article 41.4'
                },

                {
                    id: 'pa_decide_correction', name: 'Decide on Correction', symbolSize: 40, category: 3, x: 800, y: -150,
                    value: 'The Tribunal decides on the correction within 28 days of receiving the request. A correction becomes part of the Award.',
                    article: 'Article 41.1'
                },

                {
                    id: 'pa_decide_interpretation', name: 'Decide on Interpretation', symbolSize: 40, category: 3, x: 800, y: 0,
                    value: 'The Tribunal decides on the interpretation within 28 days of receiving the request. An interpretation becomes part of the Award.',
                    article: 'Article 41.2'
                },

                {
                    id: 'pa_decide_additional', name: 'Decide on Additional Award', symbolSize: 40, category: 3, x: 800, y: 150,
                    value: 'The Tribunal decides on the additional award within 56 days of receiving the request. The additional award follows the same requirements as the original Award.',
                    article: 'Article 41.4, 41.5'
                },

                {
                    id: 'pa_tribunal_correction', name: 'Tribunal Initiative Correction', symbolSize: 40, category: 3, x: 300, y: -250,
                    value: 'The Tribunal may correct computational, clerical, typographical or similar errors on its own initiative within 28 days of the date of the Award.',
                    article: 'Article 41.1'
                },

                {
                    id: 'pa_correction_award', name: 'Issue Correction', symbolSize: 40, category: 3, x: 1050, y: -150,
                    value: 'The Tribunal issues the correction to the Award, which becomes an integral part of the Award.',
                    article: 'Article 41.1'
                },

                {
                    id: 'pa_interpretation_award', name: 'Issue Interpretation', symbolSize: 40, category: 3, x: 1050, y: 0,
                    value: 'The Tribunal issues the interpretation, which becomes an integral part of the Award.',
                    article: 'Article 41.2, 41.3'
                },

                {
                    id: 'pa_additional_award', name: 'Issue Additional Award', symbolSize: 40, category: 3, x: 1050, y: 150,
                    value: 'The Tribunal issues the additional award addressing the claims omitted from the original Award.',
                    article: 'Article 41.4, 41.5'
                },

                {
                    id: 'pa_communicate_correction', name: 'Communicate to Parties', symbolSize: 40, category: 2, x: 1300, y: -150,
                    value: 'The OAC Registrar communicates the correction to the parties.',
                    article: 'Article 41.1'
                },

                {
                    id: 'pa_communicate_interpretation', name: 'Communicate to Parties', symbolSize: 40, category: 2, x: 1300, y: 0,
                    value: 'The OAC Registrar communicates the interpretation to the parties.',
                    article: 'Article 41.2, 41.3'
                },

                {
                    id: 'pa_communicate_additional', name: 'Communicate to Parties', symbolSize: 40, category: 2, x: 1300, y: 150,
                    value: 'The OAC Registrar communicates the additional award to the parties.',
                    article: 'Article 41.4, 41.5'
                },

                {
                    id: 'pa_nullity', name: 'Optional: Action for Nullity', symbolSize: 40, category: 5, x: 550, y: 250,
                    value: 'A party may seek to have the award set aside through an action for nullity in the state courts at the seat of arbitration.',
                    article: 'Article 40.8'
                },

                {
                    id: 'pa_enforcement', name: 'Award Enforcement', symbolSize: 40, category: 5, x: 1550, y: 0,
                    value: 'The Final Award (including any corrections, interpretations, or additional awards) is binding and must be carried out without delay.',
                    article: 'Article 40.8'
                },

                {
                    id: 'pa_end', name: 'End of Process', symbolSize: 50, symbol: 'circle', category: 5, x: 1800, y: 0,
                    value: 'The arbitration process is completely finalized.'
                }
            ],
            links: [
                { source: 'pa_start', target: 'pa_correction', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'pa_start', target: 'pa_interpretation', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'pa_start', target: 'pa_additional', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'pa_start', target: 'pa_tribunal_correction', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Tribunal initiative' } },
                { source: 'pa_start', target: 'pa_nullity', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'pa_start', target: 'pa_enforcement', label: { show: true, formatter: 'If no post-award requests' } },

                { source: 'pa_correction', target: 'pa_notify_correction' },
                { source: 'pa_interpretation', target: 'pa_notify_interpretation' },
                { source: 'pa_additional', target: 'pa_notify_additional' },

                { source: 'pa_notify_correction', target: 'pa_decide_correction' },
                { source: 'pa_notify_interpretation', target: 'pa_decide_interpretation' },
                { source: 'pa_notify_additional', target: 'pa_decide_additional' },
                { source: 'pa_tribunal_correction', target: 'pa_correction_award' },

                { source: 'pa_decide_correction', target: 'pa_correction_award' },
                { source: 'pa_decide_interpretation', target: 'pa_interpretation_award' },
                { source: 'pa_decide_additional', target: 'pa_additional_award' },

                { source: 'pa_correction_award', target: 'pa_communicate_correction' },
                { source: 'pa_interpretation_award', target: 'pa_communicate_interpretation' },
                { source: 'pa_additional_award', target: 'pa_communicate_additional' },

                { source: 'pa_communicate_correction', target: 'pa_enforcement' },
                { source: 'pa_communicate_interpretation', target: 'pa_enforcement' },
                { source: 'pa_communicate_additional', target: 'pa_enforcement' },
                { source: 'pa_nullity', target: 'pa_enforcement', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If challenge fails' } },

                { source: 'pa_enforcement', target: 'pa_end' }
            ]
        };

        // Fees & Costs data
        var feesData = {
            nodes: [
                {
                    id: 'fc_start', name: 'Arbitration Costs Overview', symbolSize: 50, symbol: 'circle', category: 6, x: 0, y: 0,
                    value: 'The costs of arbitration include registration fees, administrative fees, arbitrator fees and expenses, and other costs.',
                    article: 'Article 42, 43, 44, 45, 46, 47'
                },

                {
                    id: 'fc_registration', name: 'Registration Fees', symbolSize: 40, category: 6, x: 200, y: -200,
                    value: 'Non-refundable registration fee paid when filing Request for Arbitration or Counterclaim. Required for processing to begin.',
                    article: 'Article 43.1, 43.2'
                },

                {
                    id: 'fc_administrative', name: 'Administrative Fees', symbolSize: 40, category: 6, x: 200, y: -100,
                    value: 'Paid by the parties based on the value of claims/counterclaims according to the fee schedule in force. Amount may be adjusted during proceedings if value changes.',
                    article: 'Article 44.1, 44.2, 44.3'
                },

                {
                    id: 'fc_deposits', name: 'Deposits for Tribunal Costs', symbolSize: 40, category: 6, x: 200, y: 0,
                    value: 'Parties may be required to pay deposits to cover arbitrator fees and expenses. Tribunal work may be suspended if payments are not made.',
                    article: 'Article 45.1, 45.2, 45.3, 45.4'
                },

                {
                    id: 'fc_arbitrator_fees', name: 'Arbitrator Fees', symbolSize: 40, category: 6, x: 400, y: 0,
                    value: 'Based on amount in dispute, complexity, time spent, and other relevant factors. Determined by the Executive Committee.',
                    article: 'Article 46.1, 46.2'
                },

                {
                    id: 'fc_arbitrator_expenses', name: 'Arbitrator Expenses', symbolSize: 40, category: 6, x: 400, y: 100,
                    value: 'Reasonable travel, accommodation, and other expenses incurred by arbitrators are reimbursed.',
                    article: 'Article 46.3'
                },

                {
                    id: 'fc_party_costs', name: 'Party Legal & Expert Costs', symbolSize: 40, category: 6, x: 200, y: 100,
                    value: 'Each party bears its own costs for legal representation, experts, witnesses, and other expenses related to presenting their case.',
                    article: 'Article 42.1'
                },

                {
                    id: 'fc_service_provider', name: 'Service Provider Costs', symbolSize: 40, category: 6, x: 200, y: 200,
                    value: 'Costs of services required for proceedings (e.g., hearing rooms, translation, transcription, video conferencing) typically shared by parties.',
                    article: 'Article 42.1'
                },

                {
                    id: 'fc_advance_payment', name: 'Payment in Advance', symbolSize: 40, category: 6, x: 600, y: -100,
                    value: 'Administrative fees and deposits must be paid in advance, otherwise proceedings may be suspended or terminated.',
                    article: 'Article 44.5, 45.3, 45.4'
                },

                {
                    id: 'fc_equal_share', name: 'Equal Payment by Parties', symbolSize: 40, category: 6, x: 600, y: 0,
                    value: 'Parties generally pay deposits in equal shares, though one party may pay the other party\'s share if needed.',
                    article: 'Article 45.3'
                },

                {
                    id: 'fc_adjustment', name: 'Adjustment of Costs', symbolSize: 40, category: 6, x: 600, y: 100,
                    value: 'If claim value changes or new claims are added, fees and deposits may be adjusted accordingly.',
                    article: 'Article 44.3, 45.2'
                },

                {
                    id: 'fc_additional_deposit', name: 'Additional Deposits', symbolSize: 40, category: 6, x: 800, y: 0,
                    value: 'Additional deposits may be required during proceedings based on progress and complexity.',
                    article: 'Article 45.2'
                },

                {
                    id: 'fc_final_costs', name: 'Final Cost Determination', symbolSize: 40, category: 6, x: 1000, y: 0,
                    value: 'In the final Award, the Tribunal determines the costs of arbitration and decides which party shall bear them or in what proportion.',
                    article: 'Article 42.1, 42.2'
                },

                {
                    id: 'fc_allocation', name: 'Cost Allocation', symbolSize: 40, category: 6, x: 1200, y: 0,
                    value: 'The Tribunal has discretion to allocate costs between parties, considering circumstances including outcome and party conduct.',
                    article: 'Article 42.2'
                },

                {
                    id: 'fc_schedule', name: 'Fee Schedule', symbolSize: 40, category: 6, x: 800, y: -200,
                    value: 'The OAC fee schedule is published on the official website and specifies registration fees and administrative fees based on dispute value ranges.',
                    article: 'Article 43.2, 44.4'
                },

                {
                    id: 'fc_refund', name: 'Unexpended Fund Return', symbolSize: 40, category: 6, x: 1200, y: 100,
                    value: 'After the Award is rendered, the Registrar renders an accounting of deposits and returns any unexpended balance to parties.',
                    article: 'Article 45.5'
                },

                {
                    id: 'fc_end', name: 'End of Cost Process', symbolSize: 50, symbol: 'circle', category: 6, x: 1400, y: 0,
                    value: 'Cost matters finalized with the issuance of the final Award and return of any unexpended deposit funds.'
                }
            ],
            links: [
                { source: 'fc_start', target: 'fc_registration' },
                { source: 'fc_start', target: 'fc_administrative' },
                { source: 'fc_start', target: 'fc_deposits' },
                { source: 'fc_start', target: 'fc_party_costs' },
                { source: 'fc_start', target: 'fc_service_provider' },

                { source: 'fc_deposits', target: 'fc_arbitrator_fees' },
                { source: 'fc_deposits', target: 'fc_arbitrator_expenses' },
                { source: 'fc_administrative', target: 'fc_advance_payment' },
                { source: 'fc_deposits', target: 'fc_advance_payment' },
                { source: 'fc_deposits', target: 'fc_equal_share' },
                { source: 'fc_arbitrator_fees', target: 'fc_adjustment' },
                { source: 'fc_administrative', target: 'fc_adjustment' },
                { source: 'fc_adjustment', target: 'fc_additional_deposit' },
                { source: 'fc_equal_share', target: 'fc_additional_deposit' },
                { source: 'fc_administrative', target: 'fc_schedule' },
                { source: 'fc_registration', target: 'fc_schedule' },

                { source: 'fc_party_costs', target: 'fc_final_costs' },
                { source: 'fc_service_provider', target: 'fc_final_costs' },
                { source: 'fc_arbitrator_fees', target: 'fc_final_costs' },
                { source: 'fc_arbitrator_expenses', target: 'fc_final_costs' },
                { source: 'fc_additional_deposit', target: 'fc_final_costs' },

                { source: 'fc_final_costs', target: 'fc_allocation' },
                { source: 'fc_final_costs', target: 'fc_refund' },
                { source: 'fc_allocation', target: 'fc_end' },
                { source: 'fc_refund', target: 'fc_end' }
            ]
        };

        // Create chart
        var chart = echarts.init(document.getElementById('main'));

        // Tribunal Constitution process data with improved positioning
        var tribunalConstitutionData = {
            nodes: [
                {
                    id: 'tc_start', name: 'Start Tribunal Constitution', symbolSize: 50, symbol: 'circle', category: 5, x: 0, y: 0,
                    value: 'The process of constituting the Arbitral Tribunal begins after the exchange of initial submissions.'
                },

                {
                    id: 'tc_determine', name: 'Determine Number of Arbitrators', symbolSize: 40, category: 2, x: 250, y: 0,
                    value: 'The number of arbitrators is determined by the arbitration agreement. If not specified, parties may agree on the number. If no agreement within 21 days, the Executive Committee decides.',
                    article: 'Article 10.1, 10.2'
                },

                {
                    id: 'tc_sole', name: 'Sole Arbitrator Process', symbolSize: 40, category: 2, x: 500, y: -150,
                    value: 'For a sole arbitrator, parties shall nominate jointly within the time limit set by the Registrar. If they fail to agree, the Executive Committee appoints the sole arbitrator.',
                    article: 'Article 11.2'
                },

                {
                    id: 'tc_three', name: 'Three-Member Process', symbolSize: 40, category: 2, x: 500, y: 150,
                    value: 'For three arbitrators, each party nominates one. The two co-arbitrators then nominate the president. If a party fails to nominate or co-arbitrators can\'t agree, the Executive Committee appoints.',
                    article: 'Article 11.3, 11.4, 11.5'
                },

                {
                    id: 'tc_nominate_sole', name: 'Nominate Sole Arbitrator', symbolSize: 40, category: 5, x: 750, y: -150,
                    value: 'The parties jointly nominate a qualified sole arbitrator within the time limit set by the OAC Registrar.',
                    article: 'Article 11.2'
                },

                {
                    id: 'tc_fail_nominate_sole', name: 'Fail to Nominate Jointly', symbolSize: 40, category: 5, x: 750, y: -250,
                    value: 'If parties cannot agree on a sole arbitrator within the specified time limit, they lose their right to nominate.',
                    article: 'Article 11.2'
                },

                {
                    id: 'tc_nominate_wing', name: 'Each Party Nominates Co-Arbitrator', symbolSize: 40, category: 5, x: 750, y: 100,
                    value: 'Each party nominates one arbitrator in the Request for Arbitration and the Response, respectively.',
                    article: 'Article 11.3'
                },

                {
                    id: 'tc_nominate_president', name: 'Co-Arbitrators Nominate President', symbolSize: 40, category: 3, x: 1000, y: 100,
                    value: 'The two co-arbitrators nominate the president of the tribunal within the time limit set by the OAC Registrar.',
                    article: 'Article 11.4'
                },

                {
                    id: 'tc_fail_nominate_wing', name: 'Fail to Nominate Co-Arbitrator', symbolSize: 40, category: 5, x: 750, y: 200,
                    value: 'If a party fails to nominate its arbitrator, the Executive Committee will appoint that arbitrator.',
                    article: 'Article 11.5'
                },

                {
                    id: 'tc_fail_nominate_president', name: 'Fail to Nominate President', symbolSize: 40, category: 3, x: 1000, y: 200,
                    value: 'If the co-arbitrators fail to nominate the president, the Executive Committee will appoint the president.',
                    article: 'Article 11.5'
                },

                {
                    id: 'tc_committee_appoint', name: 'Executive Committee Appointment', symbolSize: 40, category: 2, x: 1250, y: 0,
                    value: 'The Executive Committee makes any needed appointments taking into account nationality, residence, independence, impartiality, and other relevant considerations.',
                    article: 'Article 11.8'
                },

                {
                    id: 'tc_send_notice', name: 'Send Notice of Appointment', symbolSize: 40, category: 2, x: 1500, y: 0,
                    value: 'The OAC Registrar sends a formal notice of appointment to each arbitrator, along with a copy of the Rules and case file.',
                    article: 'Article 12.1'
                },

                {
                    id: 'tc_disclose', name: 'Arbitrator Discloses', symbolSize: 40, category: 3, x: 1750, y: 0,
                    value: 'Each arbitrator must disclose any circumstances likely to give rise to justifiable doubts as to their impartiality or independence.',
                    article: 'Article 12.2'
                },

                {
                    id: 'tc_accept', name: 'Accept Appointment', symbolSize: 40, category: 3, x: 2000, y: 0,
                    value: 'Arbitrators must accept appointment in writing within 7 days, confirming availability, impartiality, and independence.',
                    article: 'Article 12.3'
                },

                {
                    id: 'tc_challenge', name: 'Optional: Challenge Arbitrator', symbolSize: 30, category: 5, x: 1750, y: 120,
                    value: 'Parties may challenge an arbitrator within 14 days of appointment or learning of circumstances giving rise to justifiable doubts about impartiality/independence.',
                    article: 'Article 13.1, 13.2, 13.3'
                },

                {
                    id: 'tc_decide_challenge', name: 'Decide on Challenge', symbolSize: 40, category: 2, x: 2000, y: 120,
                    value: 'The Executive Committee decides on challenges within 14 days unless arbitrator withdraws or other party agrees to challenge.',
                    article: 'Article 13.5, 13.6'
                },

                {
                    id: 'tc_replacement', name: 'Optional: Replace Arbitrator', symbolSize: 30, category: 2, x: 2250, y: 120,
                    value: 'If arbitrator dies, resigns, is successfully challenged, or removed, a replacement is appointed following the original nomination procedure.',
                    article: 'Article 14.1'
                },

                {
                    id: 'tc_complete', name: 'Tribunal Constitution Complete', symbolSize: 40, category: 3, x: 2500, y: 0,
                    value: 'The Arbitral Tribunal is constituted by an act stating the date of constitution, signed by the arbitrators, once all have accepted and challenges are resolved.',
                    article: 'Article 20.3'
                },

                {
                    id: 'tc_fees', name: 'Pay Fees & Deposits', symbolSize: 40, category: 5, x: 2750, y: 0,
                    value: 'The Registrar requests payment of administrative fees and deposits for arbitrator fees and expenses. Parties must pay within 14 days.',
                    article: 'Article 44.1, 45.1, 45.2, 45.3'
                },

                {
                    id: 'tc_transmit', name: 'Transmit File to Tribunal', symbolSize: 40, category: 2, x: 3000, y: 0,
                    value: 'After payment is complete, the Registrar transmits the case file to the Arbitral Tribunal.',
                    article: 'Article 21'
                },

                {
                    id: 'tc_end', name: 'End of Constitution Process', symbolSize: 50, symbol: 'circle', category: 3, x: 3250, y: 0,
                    value: 'The Tribunal is fully constituted and receives the file to commence proceedings.'
                }
            ],
            links: [
                { source: 'tc_start', target: 'tc_determine' },
                { source: 'tc_determine', target: 'tc_sole', label: { show: true, formatter: 'Sole arbitrator' } },
                { source: 'tc_determine', target: 'tc_three', label: { show: true, formatter: 'Three arbitrators' } },
                { source: 'tc_sole', target: 'tc_nominate_sole' },
                { source: 'tc_sole', target: 'tc_fail_nominate_sole', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If no agreement' } },
                { source: 'tc_three', target: 'tc_nominate_wing' },
                { source: 'tc_three', target: 'tc_fail_nominate_wing', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If party fails' } },
                { source: 'tc_nominate_wing', target: 'tc_nominate_president' },
                { source: 'tc_nominate_president', target: 'tc_fail_nominate_president', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If no agreement' } },
                { source: 'tc_nominate_sole', target: 'tc_committee_appoint', lineStyle: { type: 'solid' } },
                { source: 'tc_fail_nominate_sole', target: 'tc_committee_appoint' },
                { source: 'tc_nominate_president', target: 'tc_committee_appoint', lineStyle: { type: 'solid' } },
                { source: 'tc_fail_nominate_wing', target: 'tc_committee_appoint' },
                { source: 'tc_fail_nominate_president', target: 'tc_committee_appoint' },
                { source: 'tc_committee_appoint', target: 'tc_send_notice' },
                { source: 'tc_send_notice', target: 'tc_disclose' },
                { source: 'tc_disclose', target: 'tc_accept' },
                { source: 'tc_disclose', target: 'tc_challenge', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Optional' } },
                { source: 'tc_challenge', target: 'tc_decide_challenge' },
                { source: 'tc_decide_challenge', target: 'tc_replacement', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If challenge succeeds' } },
                { source: 'tc_decide_challenge', target: 'tc_accept', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'If challenge fails' } },
                { source: 'tc_replacement', target: 'tc_send_notice', lineStyle: { type: 'dashed' }, label: { show: true, formatter: 'Start over' } },
                { source: 'tc_accept', target: 'tc_complete' },
                { source: 'tc_complete', target: 'tc_fees' },
                { source: 'tc_fees', target: 'tc_transmit' },
                { source: 'tc_transmit', target: 'tc_end' }
            ]
        };

        var option = {
            series: [
                {
                    type: 'graph',
                    layout: 'none',
                    data: mainProcessData.nodes,
                    links: mainProcessData.links,
                    categories: [
                        { name: 'Claimant' },
                        { name: 'Respondent' },
                        { name: 'OAC Admin/Registrar' },
                        { name: 'Arbitral Tribunal' },
                        { name: 'Emergency Arbitrator' },
                        { name: 'All Parties' },
                        { name: 'Fees & Costs' }
                    ],
                    label: {
                        show: true,
                        position: 'right',
                        formatter: '{b}'
                    },
                    edgeSymbol: ['none', 'arrow'],
                    edgeSymbolSize: 10,
                    nodeSymbolSize: 30,
                    roam: true,
                    lineStyle: {
                        width: 2,
                        curveness: 0
                    }
                }
            ]
        };

        // Set chart options
        chart.setOption(option);

        // Event Listeners for Buttons
        document.getElementById('view-main').addEventListener('click', function () {
            chart.setOption({
                series: [{
                    data: mainProcessData.nodes,
                    links: mainProcessData.links
                }]
            });
            document.getElementById('timeline-text').textContent = timelineTexts.main;
            setActiveButtonClass('view-main');
        });

        document.getElementById('view-emergency').addEventListener('click', function () {
            chart.setOption({
                series: [{
                    data: emergencyArbitratorData.nodes,
                    links: emergencyArbitratorData.links
                }]
            });
            document.getElementById('timeline-text').textContent = timelineTexts.emergency;
            setActiveButtonClass('view-emergency');
        });

        document.getElementById('view-tribunal').addEventListener('click', function () {
            chart.setOption({
                series: [{
                    data: tribunalConstitutionData.nodes,
                    links: tribunalConstitutionData.links
                }]
            });
            document.getElementById('timeline-text').textContent = timelineTexts.tribunal;
            setActiveButtonClass('view-tribunal');
        });

        document.getElementById('view-post-award').addEventListener('click', function () {
            chart.setOption({
                series: [{
                    data: postAwardData.nodes,
                    links: postAwardData.links
                }]
            });
            document.getElementById('timeline-text').textContent = timelineTexts['post-award'];
            setActiveButtonClass('view-post-award');
        });

        document.getElementById('view-fees').addEventListener('click', function () {
            chart.setOption({
                series: [{
                    data: feesData.nodes,
                    links: feesData.links
                }]
            });
            document.getElementById('timeline-text').textContent = timelineTexts.fees;
            setActiveButtonClass('view-fees');
        });

        document.getElementById('zoom-reset').addEventListener('click', function () {
            chart.dispatchAction({
                type: 'restore'
            });
        });

        // Set active button class
        function setActiveButtonClass(id) {
            document.querySelectorAll('.controls .btn').forEach(function (btn) {
                btn.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }

        // Custom tooltip event
        chart.on('click', function (params) {
            if (params.dataType === 'node') {
                var nodeData = params.data;
                var tooltip = document.getElementById('tooltip-custom');
                var tooltipTitle = document.getElementById('tooltip-title');
                var tooltipContent = document.getElementById('tooltip-content');
                var tooltipArticle = document.getElementById('tooltip-article');

                // Update tooltip content
                tooltipTitle.textContent = nodeData.name;
                tooltipContent.textContent = nodeData.value;
                tooltipArticle.textContent = nodeData.article || '';

                // Position tooltip
                var pos = chart.convertToPixel({ seriesIndex: 0 }, [nodeData.x, nodeData.y]);
                tooltip.style.left = (pos[0] + 20) + 'px';
                tooltip.style.top = (pos[1] - 20) + 'px';
                tooltip.style.display = 'block';
            }
        });

        // Hide tooltip when clicking elsewhere
        document.addEventListener('click', function (event) {
            var tooltip = document.getElementById('tooltip-custom');
            if (!event.target.closest('#main') && !event.target.closest('#tooltip-custom')) {
                tooltip.style.display = 'none';
            }
        });

        // Add close button functionality
        document.querySelector('.tooltip-close').addEventListener('click', function () {
            document.getElementById('tooltip-custom').style.display = 'none';
        });

        // Search functionality
        document.getElementById('search-btn').addEventListener('click', function () {
            searchNodes();
        });

        document.getElementById('search-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchNodes();
            }
        });

        function searchNodes() {
            var searchTerm = document.getElementById('search-input').value.toLowerCase();
            if (!searchTerm) return;

            // Search in all datasets
            var datasets = [
                { id: 'view-main', data: mainProcessData },
                { id: 'view-emergency', data: emergencyArbitratorData },
                { id: 'view-tribunal', data: tribunalConstitutionData },
                { id: 'view-post-award', data: postAwardData },
                { id: 'view-fees', data: feesData }
            ];

            // Find matching nodes
            var found = false;
            for (var i = 0; i < datasets.length; i++) {
                var dataset = datasets[i];
                for (var j = 0; j < dataset.data.nodes.length; j++) {
                    var node = dataset.data.nodes[j];
                    var nameMatch = node.name.toLowerCase().includes(searchTerm);
                    var valueMatch = node.value.toLowerCase().includes(searchTerm);
                    var articleMatch = node.article && node.article.toLowerCase().includes(searchTerm);

                    if (nameMatch || valueMatch || articleMatch) {
                        // Switch to the dataset view
                        document.getElementById(dataset.id).click();

                        // Focus on the node
                        chart.dispatchAction({
                            type: 'focusNodeAdjacency',
                            seriesIndex: 0,
                            dataIndex: j
                        });

                        // Highlight the node
                        var pos = chart.convertToPixel({ seriesIndex: 0 }, [node.x, node.y]);
                        var tooltip = document.getElementById('tooltip-custom');
                        var tooltipTitle = document.getElementById('tooltip-title');
                        var tooltipContent = document.getElementById('tooltip-content');
                        var tooltipArticle = document.getElementById('tooltip-article');

                        tooltipTitle.textContent = node.name;
                        tooltipContent.textContent = node.value;
                        tooltipArticle.textContent = node.article || '';

                        tooltip.style.left = (pos[0] + 20) + 'px';
                        tooltip.style.top = (pos[1] - 20) + 'px';
                        tooltip.style.display = 'block';

                        found = true;
                        break;
                    }
                }
                if (found) break;
            }

            if (!found) {
                alert('No matching nodes found for: ' + searchTerm);
            }
        }

        // Enable chart to resize with window
        window.addEventListener('resize', function () {
            chart.resize();
        });
    </script>
</body>

</html>